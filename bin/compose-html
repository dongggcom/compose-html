#!/usr/bin/env node
'use strict'

const { getRootPath, getDirectSplit } = require('../lib/utils')
const path = require('path');
const program = require('commander')
const base = require('../package.json')
const SPLIT = getDirectSplit()

function exportEnvRoot(dir) {
  const ROOT_PATH = root ? path.join(getRootPath(), dir): getRootPath()
  process.env.ROOT_PATH = ROOT_PATH
  return ROOT_PATH
}

function exportEnvOutput(dir) {
  const OUTPUT_PATH = output ? path.join(getRootPath(), dir): `${getRootPath()}${SPLIT}output${SPLIT}`
  process.env.OUTPUT_PATH = OUTPUT_PATH
  return OUTPUT_PATH
}

// 版本
program.version(base.version)

program
  .command('start')
  .option('-R, --root <root>', 'set root direction')
  .description('启动服务器')
  .action(({ root }) => {
    exportEnvRoot(root)
    require('../scripts/server')()
  })

program
  .command('build')
  .option('-R, --root <root>', 'set root direction')
  .option('--output <output>', 'build files')
  .description('编译文件')
  .action(({ output, root }) => {
    const ROOT_PATH = exportEnvRoot(root)
    const OUTPUT_PATH = exportEnvOutput(output)
    require('../scripts/build')({ output: OUTPUT_PATH, root: ROOT_PATH })
  })

// 开始解析用户输入的命令
program.parse(process.argv) 