#!/usr/bin/env node
'use strict'

const { getRootPath, getDirectSplit } = require('../lib/utils')
const path = require('path');
const program = require('commander')
const base = require(`${getRootPath()}/package.json`)
const SPLIT = getDirectSplit()

// 版本
program.version(base.version)

program
  .command('start')
  .option('--watch', 'watching diretion changes')
  .option('-R, --root <root>', 'set root direction')
  .description('启动服务器')
  .action(({ root, watch }) => {
    const ROOT_PATH = root ? path.join(getRootPath(), root): getRootPath()
    process.env.ROOT_PATH = ROOT_PATH
    require('../scripts/server')({ root, watch })
  })

program
  .command('build')
  .option('-R, --root <root>', 'set root direction')
  .option('--output <output>', 'build files')
  .description('编译文件')
  .action(({ output, root }) => {
    const ROOT_PATH = root ? path.join(getRootPath(), root): getRootPath()
    process.env.ROOT_PATH = ROOT_PATH
    const OUTPUT_PATH = output ? path.join(getRootPath(), output): `${getRootPath()}${SPLIT}output${SPLIT}`
    process.env.OUTPUT_PATH = OUTPUT_PATH
    require('../scripts/build')({ output: OUTPUT_PATH, root: ROOT_PATH })
  })

// 开始解析用户输入的命令
program.parse(process.argv) 